<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêÖ Bagh-Chal: Tiger and Goats üêê</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .game-board {
            background: #e8c27a; /* parchment/yellowish-brown */
            box-shadow: 0 8px 24px rgba(90,58,27,0.15);
            border: 3px solid #5a3a1b;
            border-radius: 10px;
            cursor: pointer;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-restart { background: #3498db; color: white; }
        .btn-rules { background: #2ecc71; color: white; }
        .btn-quit { background: #e74c3c; color: white; }

        .instructions {
            background: rgba(243, 156, 18, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            max-width: 600px;
            line-height: 1.4;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #2c3e50;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        .close:hover { color: #fff; }

        .rules-content {
            line-height: 1.6;
            font-size: 14px;
        }

        .rules-content h3 {
            color: #3498db;
            margin-top: 20px;
        }
    </style>
</head>
<body>
<!-- Startup Modal -->
<div id="startupModal" class="modal" style="display:flex;align-items:center;justify-content:center;">
  <div class="modal-content" style="max-width:340px;text-align:center;">
    <h2 style="margin-bottom:20px;">Bagh-Chal: Select Mode</h2>
    <label for="startupModeSelect"><b>Choose Game Mode:</b></label>
    <select id="startupModeSelect" style="margin:16px 0;padding:10px 16px;font-size:16px;">
      <option value="human">Human vs Human</option>
      <option value="botTiger">Human vs Bot (Bot=Tigers)</option>
      <option value="botGoat">Human vs Bot (Bot=Goats)</option>
    </select>
    <br>
    <button id="startupStartBtn" class="btn btn-restart" style="font-size:18px;padding:14px 32px;margin-top:10px;">‚ñ∂Ô∏è Start Game</button>
  </div>
</div>
<div class="title">üêÖ Bagh-Chal: Tiger and Goats üêê</div>
<div id="modeDisplay" style="font-size:16px;font-weight:bold;margin-bottom:10px;display:none;"></div>
<div class="status-panel">
    <div id="status">Loading game...</div>
</div>
<canvas id="gameCanvas" class="game-board" width="500" height="500"></canvas>

<div class="controls">
    <button class="btn btn-restart" onclick="resetGame()">üîÑ Restart Game</button>
    <button class="btn btn-rules" onclick="showRules()">üìñ Rules</button>
    <button class="btn btn-quit" onclick="window.close()">‚ùå Quit</button>
</div>

<div class="instructions" id="instructions" style="display:none;"></div>

<!-- Rules Modal -->
<div id="rulesModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeRules()">&times;</span>
        <div class="rules-content">
            <h2>üêÖ BAGH-CHAL RULES üêê</h2>

            <h3>OBJECTIVE:</h3>
            <p>‚Ä¢ <strong>Tigers:</strong> Capture 5 goats to win<br>
                ‚Ä¢ <strong>Goats:</strong> Block all tigers so they cannot move</p>

            <h3>SETUP:</h3>
            <p>‚Ä¢ 4 tigers start at the corners<br>
                ‚Ä¢ 20 goats to be placed during the game</p>

            <h3>GAMEPLAY:</h3>
            <p><strong>1. PLACEMENT PHASE:</strong><br>
                ‚Ä¢ Goats are placed one by one on empty intersections<br>
                ‚Ä¢ After each goat placement, tigers can move</p>

            <p><strong>2. MOVEMENT PHASE</strong> (after all 20 goats are placed):<br>
                ‚Ä¢ Both tigers and goats can move to adjacent empty positions<br>
                ‚Ä¢ Tigers can also jump over goats to capture them<br>
                ‚Ä¢ Only one piece can be moved per turn</p>

            <h3>MOVEMENT RULES:</h3>
            <p>‚Ä¢ All pieces move along the lines to adjacent intersections<br>
                ‚Ä¢ Tigers can jump over adjacent goats to capture them<br>
                ‚Ä¢ Captured goats are removed from the board<br>
                ‚Ä¢ Goats cannot jump or capture</p>

            <h3>WIN CONDITIONS:</h3>
            <p>‚Ä¢ <strong>Tigers win</strong> by capturing 5 goats<br>
                ‚Ä¢ <strong>Goats win</strong> by blocking all tigers from moving</p>
        </div>
    </div>
</div>
<script>
    // Game constants
    const BOARD_SIZE = 5;
    const CANVAS_SIZE = 500;
    const CELL_SIZE = CANVAS_SIZE / (BOARD_SIZE + 1);
    const OFFSET = CELL_SIZE;

    // Game states
    const PLACEMENT_PHASE = 0;
    const MOVEMENT_PHASE = 1;

    // Piece types
    const EMPTY = 0;
    const TIGER = 1;
    const GOAT = 2;

    // Players
    const TIGER_PLAYER = 0;
    const GOAT_PLAYER = 1;

    // Game variables
    let currentPhase = PLACEMENT_PHASE;
    let currentPlayer = GOAT_PLAYER;
    let board = [];
    let goatsPlaced = 0;
    let goatsCaptured = 0;
    let selectedRow = -1;
    let selectedCol = -1;
    let pieceSelected = false;
    let gameOver = false;
    let winner = null;
    let connections = {};

    // Bot mode variables
    let botTiger = false;
    let botGoat = false;

    let gameStarted = false;

    function changeMode() {
      const mode = document.getElementById('modeSelect').value;
      botTiger = (mode === 'botTiger');
      botGoat = (mode === 'botGoat');
      resetGame();
    }

    // Canvas setup
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Initialize game
    function initGame() {
        setupConnections();
        resetGame();
        canvas.addEventListener('click', onCanvasClick);
    }

    function setupConnections() {
        connections = {};
        for (let i = 0; i < BOARD_SIZE; i++) {
            for (let j = 0; j < BOARD_SIZE; j++) {
                const neighbors = [];
                const directions = [[-1, -1], [-1, 0], [-1, 1], [0, -1], [0, 1], [1, -1], [1, 0], [1, 1]];

                for (const [di, dj] of directions) {
                    const ni = i + di;
                    const nj = j + dj;
                    if (ni >= 0 && ni < BOARD_SIZE && nj >= 0 && nj < BOARD_SIZE) {
                        neighbors.push([ni, nj]);
                    }
                }
                connections[`${i},${j}`] = neighbors;
            }
        }
    }

    function resetGame() {
        currentPhase = PLACEMENT_PHASE;
        currentPlayer = GOAT_PLAYER;
        board = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(EMPTY));
        goatsPlaced = 0;
        goatsCaptured = 0;
        selectedRow = -1;
        selectedCol = -1;
        pieceSelected = false;
        gameOver = false;
        winner = null;

        // Place initial tigers at corners
        board[0][0] = TIGER;
        board[0][4] = TIGER;
        board[4][0] = TIGER;
        board[4][4] = TIGER;

        drawBoard();
        updateStatus();
    }

    function getCanvasCoords(row, col) {
        const x = OFFSET + col * CELL_SIZE;
        const y = OFFSET + row * CELL_SIZE;
        return [x, y];
    }

    function getBoardCoords(canvasX, canvasY) {
        const col = Math.round((canvasX - OFFSET) / CELL_SIZE);
        const row = Math.round((canvasY - OFFSET) / CELL_SIZE);

        if (row >= 0 && row < BOARD_SIZE && col >= 0 && col < BOARD_SIZE) {
            return [row, col];
        }
        return [null, null];
    }

    function drawBoard() {
        ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

        // Board background
        ctx.fillStyle = '#e8c27a'; // parchment
        ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

        // Draw grid lines
        ctx.strokeStyle = '#5a3a1b'; // dark brown
        ctx.lineWidth = 2.5;

        for (let i = 0; i < BOARD_SIZE; i++) {
            for (let j = 0; j < BOARD_SIZE; j++) {
                const [x, y] = getCanvasCoords(i, j);
                const neighbors = connections[`${i},${j}`];

                for (const [ni, nj] of neighbors) {
                    if (ni > i || (ni === i && nj > j)) { // Avoid duplicate lines
                        const [nx, ny] = getCanvasCoords(ni, nj);
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        ctx.lineTo(nx, ny);
                        ctx.stroke();
                    }
                }
            }
        }

        // Draw intersection points
        for (let i = 0; i < BOARD_SIZE; i++) {
            for (let j = 0; j < BOARD_SIZE; j++) {
                const [x, y] = getCanvasCoords(i, j);
                ctx.fillStyle = '#ad8a56'; // brownish
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
                ctx.strokeStyle = '#5a3a1b';
                ctx.lineWidth = 1.5;
                ctx.stroke();
            }
        }

        // Draw pieces
        drawPieces();
    }

    function drawPieces() {
        for (let i = 0; i < BOARD_SIZE; i++) {
            for (let j = 0; j < BOARD_SIZE; j++) {
                const [x, y] = getCanvasCoords(i, j);

                if (board[i][j] === TIGER) {
                    // Draw tiger
                    ctx.fillStyle = '#c97a3a'; // ochre/orange
                    ctx.strokeStyle = '#5a3a1b'; // dark brown
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(x, y, 20, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.stroke();

                    // Tiger emoji (optional, can remove for classic look)
                    ctx.font = '16px Arial';
                    ctx.fillStyle = '#5a3a1b';
                    ctx.textAlign = 'center';
                    ctx.fillText('üêÖ', x, y + 6);
                } else if (board[i][j] === GOAT) {
                    // Draw goat
                    ctx.fillStyle = '#f5f3e7'; // off-white
                    ctx.strokeStyle = '#5a3a1b'; // dark brown
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(x, y, 20, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.stroke();

                    // Goat emoji (optional, can remove for classic look)
                    ctx.font = '16px Arial';
                    ctx.fillStyle = '#ad8a56';
                    ctx.textAlign = 'center';
                    ctx.fillText('üêê', x, y + 6);
                }
            }
        }

        // Highlight selected piece
        if (pieceSelected) {
            const [x, y] = getCanvasCoords(selectedRow, selectedCol);
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.arc(x, y, 25, 0, 2 * Math.PI);
            ctx.stroke();
        }
    }

    function isValidMove(fromRow, fromCol, toRow, toCol) {
        if (board[toRow][toCol] !== EMPTY) {
            return false;
        }

        // Check direct move (adjacent)
        const neighbors = connections[`${fromRow},${fromCol}`];
        for (const [nr, nc] of neighbors) {
            if (nr === toRow && nc === toCol) {
                return true;
            }
        }

        // Check tiger jump (capture)
        if (board[fromRow][fromCol] === TIGER) {
            if (Math.abs(toRow - fromRow) === 2 && Math.abs(toCol - fromCol) <= 2) {
                const midRow = Math.floor((fromRow + toRow) / 2);
                const midCol = Math.floor((fromCol + toCol) / 2);
                if (board[midRow][midCol] === GOAT) {
                    return true;
                }
            } else if (Math.abs(toCol - fromCol) === 2 && Math.abs(toRow - fromRow) <= 2) {
                const midRow = Math.floor((fromRow + toRow) / 2);
                const midCol = Math.floor((fromCol + toCol) / 2);
                if (board[midRow][midCol] === GOAT) {
                    return true;
                }
            }
        }

        return false;
    }

    function makeMove(fromRow, fromCol, toRow, toCol) {
        const piece = board[fromRow][fromCol];
        board[fromRow][fromCol] = EMPTY;
        board[toRow][toCol] = piece;

        // Check for capture
        if (piece === TIGER && (Math.abs(toRow - fromRow) === 2 || Math.abs(toCol - fromCol) === 2)) {
            const midRow = Math.floor((fromRow + toRow) / 2);
            const midCol = Math.floor((fromCol + toCol) / 2);
            if (board[midRow][midCol] === GOAT) {
                board[midRow][midCol] = EMPTY;
                goatsCaptured++;
            }
        }
    }

    function canTigersMove() {
        for (let i = 0; i < BOARD_SIZE; i++) {
            for (let j = 0; j < BOARD_SIZE; j++) {
                if (board[i][j] === TIGER) {
                    // Check all possible moves
                    const neighbors = connections[`${i},${j}`];
                    for (const [ni, nj] of neighbors) {
                        if (isValidMove(i, j, ni, nj)) {
                            return true;
                        }
                    }
                    // Check jump moves
                    for (let di = -2; di <= 2; di++) {
                        for (let dj = -2; dj <= 2; dj++) {
                            if (di === 0 && dj === 0) continue;
                            const ni = i + di;
                            const nj = j + dj;
                            if (ni >= 0 && ni < BOARD_SIZE && nj >= 0 && nj < BOARD_SIZE) {
                                if (isValidMove(i, j, ni, nj)) {
                                    return true;
                                }
                            }
                        }
                    }
                }
            }
        }
        return false;
    }

    function checkWinCondition() {
        if (goatsCaptured >= 5) {
            gameOver = true;
            winner = "Tigers";
            alert("üêÖ Tigers Win! They captured 5 goats!");
        } else if (currentPhase === MOVEMENT_PHASE && !canTigersMove()) {
            gameOver = true;
            winner = "Goats";
            alert("üêê Goats Win! All tigers are blocked!");
        }
    }

    function onCanvasClick(event) {
      if (!gameStarted) return;
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      const [row, col] = getBoardCoords(x, y);
      if (row === null || col === null) return;
      if (currentPhase === PLACEMENT_PHASE && currentPlayer === GOAT_PLAYER) {
        if (board[row][col] === EMPTY && goatsPlaced < 20) {
          board[row][col] = GOAT;
          goatsPlaced++;
          if (goatsPlaced === 20) currentPhase = MOVEMENT_PHASE;
          currentPlayer = TIGER_PLAYER;
        }
      } else {
        if (!pieceSelected) {
          if ((currentPlayer === TIGER_PLAYER && board[row][col] === TIGER) ||
              (currentPlayer === GOAT_PLAYER && board[row][col] === GOAT)) {
            selectedRow = row;
            selectedCol = col;
            pieceSelected = true;
          }
        } else {
          if (row === selectedRow && col === selectedCol) {
            pieceSelected = false;
            selectedRow = -1;
            selectedCol = -1;
          } else if (isValidMove(selectedRow, selectedCol, row, col)) {
            makeMove(selectedRow, selectedCol, row, col);
            pieceSelected = false;
            selectedRow = -1;
            selectedCol = -1;
            currentPlayer = 1 - currentPlayer;
          } else {
            if ((currentPlayer === TIGER_PLAYER && board[row][col] === TIGER) ||
                (currentPlayer === GOAT_PLAYER && board[row][col] === GOAT)) {
              selectedRow = row;
              selectedCol = col;
              pieceSelected = true;
            } else {
              pieceSelected = false;
              selectedRow = -1;
              selectedCol = -1;
            }
          }
        }
      }
      drawBoard();
      updateStatus();
      checkWinCondition();
      setTimeout(botMoveIfNeeded, 300);
    };

    function botMoveIfNeeded() {
      if (gameOver) return;
      // Placement phase, goat bot
      if (currentPhase === PLACEMENT_PHASE && currentPlayer === GOAT_PLAYER && botGoat && goatsPlaced < 20) {
        let empties = [];
        for (let i = 0; i < BOARD_SIZE; i++)
          for (let j = 0; j < BOARD_SIZE; j++)
            if (board[i][j] === EMPTY) empties.push([i, j]);
        if (empties.length > 0) {
          const [row, col] = empties[Math.floor(Math.random() * empties.length)];
          board[row][col] = GOAT;
          goatsPlaced++;
          if (goatsPlaced === 20) currentPhase = MOVEMENT_PHASE;
          currentPlayer = TIGER_PLAYER;
          drawBoard();
          updateStatus();
          checkWinCondition();
          setTimeout(botMoveIfNeeded, 300);
        }
      } else if (currentPhase === MOVEMENT_PHASE) {
        const botSide = (currentPlayer === TIGER_PLAYER && botTiger) || (currentPlayer === GOAT_PLAYER && botGoat);
        if (botSide) {
          let moves = [];
          for (let i = 0; i < BOARD_SIZE; i++) {
            for (let j = 0; j < BOARD_SIZE; j++) {
              if ((currentPlayer === TIGER_PLAYER && board[i][j] === TIGER) || (currentPlayer === GOAT_PLAYER && board[i][j] === GOAT)) {
                // Normal moves
                const neighbors = connections[`${i},${j}`];
                for (const [ni, nj] of neighbors) {
                  if (isValidMove(i, j, ni, nj)) moves.push([i, j, ni, nj]);
                }
                // Tiger jumps
                if (currentPlayer === TIGER_PLAYER) {
                  for (let di = -2; di <= 2; di++) {
                    for (let dj = -2; dj <= 2; dj++) {
                      if (di === 0 && dj === 0) continue;
                      const ni = i + di, nj = j + dj;
                      if (ni >= 0 && ni < BOARD_SIZE && nj >= 0 && nj < BOARD_SIZE) {
                        if (isValidMove(i, j, ni, nj)) moves.push([i, j, ni, nj]);
                      }
                    }
                  }
                }
              }
            }
          }
          if (moves.length > 0) {
            const [fr, fc, tr, tc] = moves[Math.floor(Math.random() * moves.length)];
            makeMove(fr, fc, tr, tc);
            currentPlayer = 1 - currentPlayer;
            drawBoard();
            updateStatus();
            checkWinCondition();
            setTimeout(botMoveIfNeeded, 300);
          }
        }
      }
    }

    let gameStarted = false;
    // Modal logic: always attach handler immediately
    function setupStartupModal() {
      document.getElementById('startupModal').style.display = 'flex';
      document.getElementById('instructions').style.display = 'none';
      document.getElementById('modeDisplay').style.display = 'none';
      enableControls(false);
      document.getElementById('startupStartBtn').onclick = function() {
        const mode = document.getElementById('startupModeSelect').value;
        botTiger = (mode === 'botTiger');
        botGoat = (mode === 'botGoat');
        updateModeDisplay();
        document.getElementById('startupModal').style.display = 'none';
        gameStarted = true;
        enableControls(true);
        document.getElementById('modeDisplay').style.display = '';
        resetGame();
      };
    }
    setupStartupModal();

    function updateModeDisplay() {
      let text = 'Mode: ';
      if (botTiger) text += 'Human vs Bot (Tigers)';
      else if (botGoat) text += 'Human vs Bot (Goats)';
      else text += 'Human vs Human';
      document.getElementById('modeDisplay').innerText = text;
    }

    const origResetGame = resetGame;
    resetGame = function() {
      origResetGame();
      if (!gameStarted) return;
      document.getElementById('instructions').style.display = 'none';
      document.getElementById('modeDisplay').style.display = '';
      updateModeDisplay();
    };

    const origOnCanvasClick = onCanvasClick;
    onCanvasClick = function(event) {
      if (!gameStarted) return;
      origOnCanvasClick(event);
    };

    // Patch Rules/Restart/Quit buttons to not work if not started
    function setupControlGuards() {
      document.querySelector('.btn-restart').onclick = function() {
        if (!gameStarted) return;
        resetGame();
      };
      document.querySelector('.btn-quit').onclick = function() {
        if (!gameStarted) return;
        window.close();
      };
      document.querySelector('.btn-rules').onclick = function() {
        if (!gameStarted) return;
        showRules();
      };
    }
    setupControlGuards();

    function enableControls(enable) {
      document.getElementById('gameCanvas').style.pointerEvents = enable ? 'auto' : 'none';
      document.querySelectorAll('.btn').forEach(btn => btn.disabled = !enable);
      document.getElementById('modeSelect').disabled = false; // Mode selector should always be enabled
    }

    function updateStatus() {
        let statusText, instructionText;

        if (gameOver) {
            statusText = `Game Over! Winner: ${winner}`;
            instructionText = `üéâ ${winner} have won the game! Click 'Restart Game' to play again.`;
        } else {
            const phaseText = currentPhase === PLACEMENT_PHASE ? "Placement Phase" : "Movement Phase";
            const playerText = currentPlayer === TIGER_PLAYER ? "Tigers" : "Goats";
            statusText = `${phaseText} - Current Player: ${playerText}`;

            if (currentPhase === PLACEMENT_PHASE) {
                instructionText = `üêê Place goats on empty intersections. Goats placed: ${goatsPlaced}/20`;
            } else if (currentPlayer === TIGER_PLAYER) {
                if (pieceSelected) {
                    instructionText = "üêÖ Tiger selected! Click on an empty adjacent position or jump over a goat to capture it.";
                } else {
                    instructionText = "üêÖ Tigers' turn! Click on a tiger to select it.";
                }
            } else {
                if (pieceSelected) {
                    instructionText = "üêê Goat selected! Click on an empty adjacent position to move.";
                } else {
                    instructionText = "üêê Goats' turn! Click on a goat to select it.";
                }
            }
        }
        document.getElementById('status').textContent = statusText;
        document.getElementById('instructions').innerHTML = `${instructionText}<br>Goats captured: ${goatsCaptured}/5`;
    }

    function showRules() {
        document.getElementById('rulesModal').style.display = 'block';
    }

    function closeRules() {
        document.getElementById('rulesModal').style.display = 'none';
    }

    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        const modal = document.getElementById('rulesModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });

    window.addEventListener('load', function() {
      initGame();
    });
</script>
</body>
</html>